var TVE_Content_Builder=TVE_Content_Builder||{};var var1=1;(function(b){var a=0;TVE_Content_Builder.colors={trigger_tpl:'<div class="tve_color_picker_item"><a href="javascript:void(0)"></a></div>',iris_container:"#tve_iris_holder",iris:null,css_mappings:{border:"border-bottom-color","border-color":"border-bottom-color","box-shadow-all":"box-shadow"},css_props:{gradient:"background-image: -webkit-gradient(linear, 50% 0%, 50% 100%, color-stop(0%, [color0]), color-stop(100%, [color1])) !important;background-image: -webkit-linear-gradient([color0] 0%, [color1] 100%) !important;background-image: -moz-linear-gradient([color0] 0%, [color1] 100%) !important;background-image: -o-linear-gradient([color0] 0%, [color1] 100%) !important;background-image: linear-gradient([color0] 0%, [color1] 100%) !important;","inset-box-shadow":"-webkit-box-shadow: inset 0 0 24px [color];-moz-box-shadow: inset 0 0 24px [color];box-shadow: inset 0 0 24px [color];","box-shadow":"-webkit-box-shadow: 10px 10px 5px 0px [color];-moz-box-shadow: 10px 10px 5px 0px [color];box-shadow: 10px 10px 5px 0px [color];","box-shadow-all":"-webkit-box-shadow: [css_values] !important;-moz-box-shadow: [css_values] !important;box-shadow: [css_values] !important;"},custom_classes:"",element_colors:[],current_color:null,current_opacity:null,current_trigger:null,current_type:null,change_timeout_delay:-1,max_color_history:12,on_menu_show:function(d,c){if(d=="text"||d=="text_inline_only"){c=b(".edit_mode")}if(!c){return false}var g=b("#"+d+"_menu");var f=this.get_color_settings(d,c),e=g.find(".text_colour_picker");if(!f&&!e.length){g.find(".tve_color_picker .tve_options_headline").hide();return false}g.find(".tve_color_picker .tve_options_headline").show();this.init_once();this.element_colors=f;this.current_type=d;if(f){this.clear_hover_colors();this.build_triggers(g,f)}if(e.length){this.build_text_triggers(e,c)}},refresh:function(){if(!this.current_type){return}var d=b("#"+this.current_type+"_menu"),c=d.find(".text_colour_picker");if(this.element_colors){this.build_triggers(d,this.element_colors)}if(c.length){this.build_text_triggers(c,b(".edit_mode"))}},init_once:function(){if(!this.iris){var d=this;this.iris=b(this.iris_container).iris({target:b("#tve_current_color"),width:255,mode:"hsv",border:false,palettes:window.tve_custom_colours,change:function(h,i){d.onChange()}});this.iris.on("click mousedown",function(h){h.stopPropagation&&h.stopPropagation()});var f=this.iris.find(".wp-opacity-slider"),c=this.iris.find("#tve_cp_opacity");f.slider({value:100,min:0,max:100,slide:function(i,j){var h=parseInt(j.value);c.val(h);d.current_opacity=h/100;d.onChange()}});c.change(function(){var h=parseInt(this.value);if(isNaN(h)||h<0||h>100){h=100;this.value=h}d.current_opacity=h/100;f.slider("option","value",h);d.onChange()});b("#tve_cp_color").change(function(){try{d.iris.iris("color",this.value)}catch(h){}});this.iris.find("#tve_cp_save_fav").on("click",function(){var h=d.iris.iris("color");if(window.tve_custom_colours.indexOf(h)!=-1){tve_add_notification("Favourite colour "+h+" already exists!",true);return}window.tve_custom_colours.push(h);window.tve_custom_colours=window.tve_custom_colours.slice(Math.max(window.tve_custom_colours.length-d.max_color_history,0));d.iris.iris("option","palettes",window.tve_custom_colours)});this.iris.find("#tve_cp_ok").on("click",function(){d.hide_picker()});for(var e=0,g;g=tve_path_params.shortcode_colours[e++];){this.custom_classes+=(this.custom_classes?" ":"")+"tve_"+g}b(".active_sub_menu").on("tve.hide_sub_menu",function(){d.hide_picker()})}},get_color_settings:function(e,d){var f=tve_path_params.tve_colour_mapping[e]?tve_path_params.tve_colour_mapping[e]:false,c=d.attr("data-tve-style");if(!f||!f[c]){return false}f=f[c];return f[tve_path_params.tve_loaded_stylesheet]?f[tve_path_params.tve_loaded_stylesheet]:false},build_triggers:function(e,f){e.find(".tve_color_picker_container").remove();var d=b('<div class="tve_color_picker_container tve_clearfix"></div>').appendTo(e.find(".tve_color_picker")),c=this;b.each(f,function(h,j){var g=c.build_trigger(h,{});if(!g){return}d.append(g)})},build_text_triggers:function(e,c){var d=this;e.each(function(){var i=b(this).hide(),f=b('<div class="tve_color_picker_container tve_clearfix"></div>'),g=i.attr("data-highlight")?1:0,h={label:g?"Highlight color":"Text color",text_picker:1,is_highlight:g,css:g?"backgroundColor":"color",doc_cmd:g?"BackColor":"ForeColor"};h.color=g?"#FFFFFF":c.css(h.css);i.parent().find(".tve_color_picker_container").remove();i.parent().append(f);f.append(d.build_trigger(-1,h))})},build_trigger:function(m,k){var g,c;if(m===-1){g=k;c=[g.color?g.color:"none"]}else{g=this.element_colors[m];var h=this.css_mappings[g.property]?this.css_mappings[g.property]:g.property,d=this.get_selector(g);if(!b(d).length){return false}if((g.property==="background-color"||g.original_property==="background-color")&&b(d).css("background-image")&&b(d).css("background-image").indexOf("gradient")!==-1){this.element_colors[m].property="background-image";this.element_colors[m].original_property="background-color";this.element_colors[m].original_value=this.element_colors[m].value;this.element_colors[m].value="gradient";h="background-image"}else{if(typeof this.element_colors[m].original_value!=="undefined"){this.element_colors[m].property="background-color";this.element_colors[m].value=this.element_colors[m].original_value;h="background-color"}}if(g.value==="box-shadow-all"){c=this.parse_box_shadow(d,g).found_color}else{c=this.parse_colors(b(d).css(h));if(!c||!c.length){if(g.value==="gradient"){c=this.parse_colors(b(d).css("backgroundColor"));c=c&&c.length?[c[0],c[0]]:["transparent","transparent"]}else{c=["transparent"]}}}if(!g.hover){g.all_colors=c}}if(!g.hover_colors){g.hover_colors=c}else{if(g.hover&&g.hover_colors){c=g.hover_colors}}var j=b(),l;for(var f=0,e;e=c[f++];){l=b(this.trigger_tpl).find("a").attr("title",g.label+(c.length>1?(" "+f):"")).css("background-color",e);if(!g.text_picker){g.cp_index=m;g.color_value=e;g.css_selector=d+(g.additional_elements?","+(g.search_outside?g.additional_elements:modify_selector_edit_mode(g.additional_elements)):"");l.data("color_index",f-1);this.element_colors[m]=g}l.data("color_config",g);l.click(this.open_picker);j=j.add(l.parent())}return j},get_selector:function(d,e){if(typeof e==="undefined"){e=false}var c=d.selector;if(!e&&d.hover&&d.selector_hover){c+=" "+d.selector_hover}return(d.search_outside?c:modify_selector_edit_mode(c))},parse_colors:function(h){h=escapeHTML(typeof h==="undefined"?"":h);var k=/RGB\s*\(\s*-?[0-9]{1,3}%?\s*,\s*-?[0-9]{1,3}%?\s*,\s*-?[0-9]{1,3}%?\)/ig;var g=/RGBA\s*\(\s*[0-9]{1,3}%?\s*,\s*[0-9]{1,3}%?\s*,\s*[0-9]{1,3}%?\s*,\s*[0-9]*\.?[0-9]*\s*\)/ig;var c=/#[0-9a-f]{3}([0-9a-f]{3})?\b/ig;var f=/HSL\s*\(\s*-?[0-9]{1,3}\s*,\s*[0-9]{1,3}%\s*,\s*[0-9]{1,3}%\)/ig;var e=/HSLA\s*\(\s*-?[0-9]{1,3}\s*,\s*[0-9]{1,3}%\s*,\s*[0-9]{1,3}%\s*,\s*[0-9]*\.?[0-9]*\s*\)/ig;var j=/\bAliceBlue\b|\bAntiqueWhite\b|\bAqua\b|\bAquamarine\b|\bAzure\b|\bBeige\b|\bBisque\b|\bBlack\b|\bBlanchedAlmond\b|\bBlue\b|\bBlueViolet\b|\bBrown\b|\bBurlyWood\b|\bCadetBlue\b|\bChartreuse\b|\bChocolate\b|\bCoral\b|\bCornflowerBlue\b|\bCornsilk\b|\bCrimson\b|\bCyan\b|\bDarkBlue\b|\bDarkCyan\b|\bDarkGoldenRod\b|\bDarkGray\b|\bDarkGreen\b|\bDarkKhaki\b|\bDarkMagenta\b|\bDarkOliveGreen\b|\bDarkorange\b|\bDarkOrchid\b|\bDarkRed\b|\bDarkSalmon\b|\bDarkSeaGreen\b|\bDarkSlateBlue\b|\bDarkSlateGray\b|\bDarkTurquoise\b|\bDarkViolet\b|\bDeepPink\b|\bDeepSkyBlue\b|\bDimGray\b|\bDodgerBlue\b|\bFireBrick\b|\bFloralWhite\b|\bForestGreen\b|\bFuchsia\b|\bGainsboro\b|\bGhostWhite\b|\bGold\b|\bGoldenRod\b|\bGray\b|\bGreen\b|\bGreenYellow\b|\bHoneyDew\b|\bHotPink\b|\bIndianRed\b|\bIndigo\b|\bIvory\b|\bKhaki\b|\bLavender\b|\bLavenderBlush\b|\bLawnGreen\b|\bLemonChiffon\b|\bLightBlue\b|\bLightCoral\b|\bLightCyan\b|\bLightGoldenRodYellow\b|\bLightGrey\b|\bLightGreen\b|\bLightPink\b|\bLightSalmon\b|\bLightSeaGreen\b|\bLightSkyBlue\b|\bLightSlateGray\b|\bLightSteelBlue\b|\bLightYellow\b|\bLime\b|\bLimeGreen\b|\bLinen\b|\bMagenta\b|\bMaroon\b|\bMediumAquaMarine\b|\bMediumBlue\b|\bMediumOrchid\b|\bMediumPurple\b|\bMediumSeaGreen\b|\bMediumSlateBlue\b|\bMediumSpringGreen\b|\bMediumTurquoise\b|\bMediumVioletRed\b|\bMidnightBlue\b|\bMintCream\b|\bMistyRose\b|\bMoccasin\b|\bNavajoWhite\b|\bNavy\b|\bOldLace\b|\bOlive\b|\bOliveDrab\b|\bOrange\b|\bOrangeRed\b|\bOrchid\b|\bPaleGoldenRod\b|\bPaleGreen\b|\bPaleTurquoise\b|\bPaleVioletRed\b|\bPapayaWhip\b|\bPeachPuff\b|\bPeru\b|\bPink\b|\bPlum\b|\bPowderBlue\b|\bPurple\b|\bRed\b|\bRosyBrown\b|\bRoyalBlue\b|\bSaddleBrown\b|\bSalmon\b|\bSandyBrown\b|\bSeaGreen\b|\bSeaShell\b|\bSienna\b|\bSilver\b|\bSkyBlue\b|\bSlateBlue\b|\bSlateGray\b|\bSnow\b|\bSpringGreen\b|\bSteelBlue\b|\bTan\b|\bTeal\b|\bThistle\b|\bTomato\b|\bTurquoise\b|\bViolet\b|\bWheat\b|\bWhite\b|\bWhiteSmoke\b|\bYellow\b|\bYellowGreen\b/ig;var i=new RegExp(k.source+"|"+g.source+"|"+c.source+"|"+f.source+"|"+e.source+"|"+j.source,"ig");var d=h.match(i);return !!d&&d.length===3?d.slice(1,3):d},to_rgba:function(d){var c,e=parseInt,d=d.replace(/\s\s*/g,"");if(c=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})/.exec(d)){c=[e(c[1],16),e(c[2],16),e(c[3],16)]}else{if(c=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])/.exec(d)){c=[e(c[1],16)*17,e(c[2],16)*17,e(c[3],16)*17]}else{if(c=/^rgba\(([\d]+),([\d]+),([\d]+),([\d]+|[\d]*.[\d]+)\)/.exec(d)){c=[+c[1],+c[2],+c[3],+c[4]]}else{if(c=/^rgb\(([\d]+),([\d]+),([\d]+)\)/.exec(d)){c=[+c[1],+c[2],+c[3]]}else{if(d==="transparent"){return[d]}else{throw Error(d+" is not supported by $.parseColor")}}}}}isNaN(c[3])&&(c[3]=1);return c.slice(0,3+4)},open_picker:function(){var c=b(this),e=TVE_Content_Builder.colors.iris.removeClass("tve_iris_bottom"),d=c.css("backgroundColor"),f=c.data("color_config"),h=f.opacity,i;TVE_Content_Builder.colors.current_trigger=c;b.when(e.show().iris("color",d).iris("show")).then(function(){e.offset().top<32&&e.addClass("tve_iris_bottom")});i=e.iris("color",true);e.find("#tve_opacity_ctrl").css("display",h?"block":"none");e.find("#tve_cp_title").html(c.attr("title"));e.find("#tve_cp_color").val(i.toString());TVE_Content_Builder.colors.current_color=i.toString();if(h){var g=TVE_Content_Builder.colors.to_rgba(d);if(g[3]){e.find("#tve_cp_opacity").val(Math.round(parseFloat(g[3])*100)).trigger("change");TVE_Content_Builder.colors.current_opacity=g[3]}}else{TVE_Content_Builder.colors.current_opacity=null}c.parents(".active_sub_menu").addClass("tve_color_picker_hidden")},hide_picker:function(){TVE_Content_Builder.colors.iris.hide();b(".tve_color_picker_hidden").removeClass("tve_color_picker_hidden")},onChange:function(){var d=this.iris.iris("color",true),f=this.current_trigger.data("color_config"),c=this;f.color_index=this.current_trigger.data("color_index");if(this.current_opacity!==null){var e=d.toRgb();d="rgba("+e.r+","+e.g+","+e.b+","+this.current_opacity+")"}else{d=d.toString()}this.current_trigger.css("backgroundColor",d);this.iris.find("#tve_cp_color").val(d);if(f.text_picker){return this._textColor(d,f)}clearTimeout(a);if(this.change_timeout_delay>0){a=setTimeout(function(){c._customColor(d,f)},this.change_timeout_delay)}else{this._customColor(d,f)}},_customColor:function(d,g){this.element_colors[g.cp_index].color_value=d;var c=this.get_selector(g,true),f=tve_get_unique_css_identifier(c,this.current_type!="table_cell"),e=this.get_css(g,[]),h=g.hover?":hover":"";if(g.hover&&g.selector_hover){h+=" "+g.selector_hover}b.when(tve_remove_css_rule(f,null,h)).then(tve_add_css_rule("[data-tve-custom-colour='"+f+"']"+h,e,0));b(TVE_Editor_Page).trigger("editor.oncolorpickerchange",[this.current_type,g.property]);if(g.global_save_key){tve_path_params.tve_globals[g.global_save_key]=f}},_textColor:function(c,e){if(!window.textselection){window.textselection=rangy.saveSelection()}rangy.restoreSelection(window.textselection);window.textselection=rangy.saveSelection();var d=rangy.getSelection();if(d.toString().length){document.execCommand(e.doc_cmd,false,c);d.removeAllRanges();return}jQuery(".edit_mode").css(e.css,c)},get_css:function(d,f){var m=typeof d.color_index!=="undefined"?d.color_index:false,g=d.color_value,k=d.hover?"hover_colors":"all_colors",j=this.css_props[d.value]?this.css_props[d.value]:(d.property+":"+d.value+" !important;"),n=false;switch(d.value){case"gradient":if(m!==false){this.element_colors[d.cp_index][k][m]=g}else{m=0;g=this.element_colors[d.cp_index][k][0]}j=replaceAll("[color"+m+"]",g,j);j=replaceAll("[color"+(m==0?"1":"0")+"]",d[k][Math.abs(m-1)],j);this.element_colors[d.cp_index][k][d.color_index]=g;n=true;break;case"box-shadow-all":var l=TVE_Content_Builder.controls.shadow.color_changed(g,d.inset?true:false);j=replaceAll("[css_values]",TVE_Content_Builder.controls.shadow.get_css_values(l),j);this.element_colors[d.cp_index][k][0]=g;n=true;break;default:break}if(!n){j=replaceAll("[color]",g,j);if(m!==false){this.element_colors[d.cp_index][k][m]=g}}f.push(d.cp_index);for(var h=0,e;e=this.element_colors[h++];){var c=(e.hover===d.hover)&&e.selector==d.selector;c=c&&d.selector_hover===e.selector_hover;if(c&&b.inArray(h-1,f)===-1){j+=this.get_css(e,f)}}return j},parse_box_shadow:function(f,g){var e=b(f).css("box-shadow"),c,l={i:"",o:""};if(!e||!e.length||e==="none"){return{found_color:["transparent"],colors:{i:"transparent",o:"transparent"},css_rules:l}}if(typeof g==="undefined"){g={inset:1}}var h={i:"transparent",o:"transparent"},d=false;if(e.indexOf("rgb")!==-1){e=e.replace(/rgb(a)?\s*\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*(,)?\s*([0-9]*\.?[0-9]*)?\s*\)/gi,"rgb$1($2_$3_$4_$6)");e=e.replace("_)",")");d=true}e=e.split(",");for(var j=0,k;k=e[j++];){if(d){k=k.replace(/rgb(a)?\(([0-9]{1,3})_([0-9]{1,3})_([0-9]{1,3})(_)?([0-9]*\.?[0-9]*)?\)/gi,"rgb$1($2,$3,$4,$6)");k=k.replace(",)",")")}c=this.parse_colors(k);if(k.indexOf("inset")!==-1){h.i=c&&c.length?c[0]:"transparent";l.i=k}else{h.o=c&&c.length?c[0]:"transparent";l.o=k}}return{found_color:g.inset?[h.i]:[h.o],colors:h,css_rules:l}},clear_hover_colors:function(){var c=this;b.each(this.element_colors,function(d){delete c.element_colors[d].hover_colors})}}})(jQuery);